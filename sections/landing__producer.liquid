<style>
  .text-center {
    text-align: center;
    margin: auto;
  }
  .landing__producer {
    padding: 60px 0;
  }
  .landing__producer--head {
    gap: 40px;
  }
  .container {
    max-width: 1200px;
    padding-left: 15px;
    padding-right: 15px;
    margin: auto;
  }
  .landing__producer--head {
    width: 100%;
  }
  .landing__producer--head_title {
    color: #004228;
    font-size: 64px;
    margin-bottom: 30px;
  }
  .landing__producer--head_text {
    margin-bottom: 20px;
  }
  .landing__producer--subtitle {
    text-align: center;
    margin: 40px auto 20px;
    font-size: 40px;
    width: 100%;
  }
  .landing__producer--boxes {
    display: flex;
    width: 100%;
    justify-content: space-around;
    margin: 40px 0;
    flex-wrap: wrap;
    gap: 40px;
  }
  .landing__producer--item {
    text-align: center;
    max-width: 300px;
    display: grid;
    grid-template-rows: 190px 1fr;
    gap: 0;
    justify-content: space-between;
  }
  #landing__producer--image{
    width: 100%;
  }

  .landing__producer--producers {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(4,1fr);
    justify-content: center;
    gap: 50px;
    flex-wrap: wrap;
    margin: 40px 0;
  }
  #youtubeIframe {
    margin-bottom: 30px;
  }
  .landing__claim--subtitle {
    color: #004228;
    margin-top: 30px;
  }
  .landing__producer--item_title {
    /* background: linear-gradient(to right,currentColor,currentColor) 0 min(100%, 1.35em) / 0 1px no-repeat; */
    transition: background-size 0.3s ease-in-out, color 0.3s ease-in-out;
    width: fit-content;
    margin: 10px auto 0;
    opacity: 0.7;
  }
  .landing__producer--item_title:hover {
    background-size: 100% 1px;
    opacity: 1;
    color: #004228;
  }
  /* Media Queries */
  @media screen and (max-width: 768px) {
    .landing__producer--head_title {
      font-size: 48px;
    }
    .landing__producer--subtitle {
      font-size: 30px;
    }
    .landing__producer--boxes {
      flex-direction: column;
      align-items: center;
    }
    .landing__producer--item {
      margin-bottom: 20px;
    }
  }

  @media screen and (max-width: 480px) {
    .landing__producer--head_title {
      font-size: 36px;
    }
    .landing__producer--subtitle {
      font-size: 24px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {

// Obtener los parámetros de la URL
    var urlParams = new URLSearchParams(window.location.search);
    var producerId = urlParams.get('producer_id');

    handleproducerId(producerId);
  });

  async function handleproducerId(producerId) {
    const producerContent = document.getElementById('producerIDcontent');
    const generalContent = document.getElementById('noProducerIDcontent');

    if (producerId) { // Realizar acciones cuando producerId tiene un valor
      try {
        const response = await fetch(`https://ecotech.ecoterra.cl/api/ecofarmers/${producerId}`, {
          method: 'GET',
          credentials: 'omit' // Esto evita que las cookies se incluyan en la solicitud
        });
        const data = await response.json();
        const producer = data.producer;
        renderProducer(producer);
        renderMap(producer);

        // Eliminar el div del DOM
        generalContent.parentNode.removeChild(generalContent);
        producerContent.classList.remove('d-none');
      } catch (error) {
        console.error("Error:", error);
      }
    } else { // Realizar acciones cuando producerId no tiene un valor
      const container = document.querySelector('.landing__producer--producers');
      try {
        const response = await fetch(`https://ecotech.ecoterra.cl/api/ecofarmers`, {
          method: 'GET',
          credentials: 'omit' // Esto evita que las cookies se incluyan en la solicitud
        });
        const data = await response.json();
        const producers = data.producers;
        producers.forEach(producer => {
          if(producer.claims.length){
            const producerElement = createProducerElement(producer);
            container.appendChild(producerElement);
          }
        });

        // Eliminar el div del DOM
        producerContent.parentNode.removeChild(producerContent);
        generalContent.classList.remove('d-none');
      } catch (error) {
        console.error("Error:", error);
      }
    }
  }
</script>
<div id="producerIDcontent" class="d-none">
  <script>
    var currentInfoWindow = null;

    function renderProducer(producer) {
      const titleElement = document.querySelector('.landing__producer--head_title');
      const textElement = document.querySelector('.landing__producer--head_text');
      const imageElement = document.querySelector('#landing__producer--image');
     // const iframe = document.querySelector('#youtubeIframe');

      // Actualizar el contenido de los elementos con la información del claim
      titleElement.textContent = producer.name;
      textElement.textContent = producer.description;
      imageElement.src = producer.imgUrl;
      imageElement.style = "100%";
      // iframe.src = producer.videoUrl;

      // Iterar sobre cada productor y agregar sus elementos al contenedor
      const container = document.querySelector('.landing__producer--boxes');
      const listOfClaims = [];
      producer.claims.forEach(producer => {
        const producerElement = createClaimElement(producer);
        container.appendChild(producerElement);
        listOfClaims.push(producer.templateId);
        
      });
      if(producer.products.length){
        producer.products.forEach(product => {
          product.claims.forEach(claim => {
            if (!listOfClaims.includes(claim.templateId)) {
              const producerElement = createClaimElement(claim);
              container.appendChild(producerElement);
              listOfClaims.push(claim.templateId);
            }
          });
        });
      }
    }

    function renderMap(producer) {

// Coordenadas del centro del mapa

/* var center = {
      lat: -33.831550,
      lng: -70.706332
    };*/

// Opciones de configuración del mapa
      var mapOptions = {
        zoom: 10, // Nivel de zoom
        center: producer.location, // Centro del mapa
        zoomControl: false, // Ocultar control de zoom
        mapTypeControl: false
      };

// Crear mapa
      var map = new google.maps.Map(document.querySelector(`#map`), mapOptions);

// Iterar sobre los puntos y agregar marcadores al mapa
// points.forEach(function(point) {

      if (producer.location.absolute) { // Crear marcador
        var marker = new google.maps.Marker({position: producer.location, map: map, title: producer.name});

// Crear el contenido personalizado con HTML
        var contentString = `<div id="content" class="content-popup-map" style="width: 200px; display:flex; flex-direction: column; gap: 10px;">
            <h2 id="firstHeading" class="firstHeading">
            ${producer.name}
            </h2>
            <img src="${
              producer.imgUrl
            }" style="height: 50px; width: 100px; object-fit: cover;" loading="lazy"/>
            <p>${producer.description}</p>
            ${
              template[0]
                ? template[0].claimFiles
                    .filter((element) => element !== "")
                    .map(
                      (element) =>
                        `<a href="${element.url}" target="_blank" rel="noopener noreferrer">Ver evidencia <svg xmlns="http://www.w3.org/2000/svg" height="0.75em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#959b03}</style><path d="M0 64C0 28.7 28.7 0 64 0H224V128c0 17.7 14.3 32 32 32H384V304H176c-35.3 0-64 28.7-64 64V512H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0L384 128zM176 352h32c30.9 0 56 25.1 56 56s-25.1 56-56 56H192v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V448 368c0-8.8 7.2-16 16-16zm32 80c13.3 0 24-10.7 24-24s-10.7-24-24-24H192v48h16zm96-80h32c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H304c-8.8 0-16-7.2-16-16V368c0-8.8 7.2-16 16-16zm32 128c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H320v96h16zm80-112c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16s-7.2 16-16 16H448v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16H448v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V432 368z"/></svg> </a>`
                    )
                    .join(" ")
                : ""
            } 
            ${
              template[0].claimFiles.length !== 0
                ? `
            <div class="claim--popup__table">
              <p class="claim--popup__table--title">Fechas</p>
              <p class="claim--popup__table--content">Emisión: ${formatDateToDDMMYYYY(
                template[0].validFrom
              )}</p>
              <p class="claim--popup__table--content">Validez: ${formatDateToDDMMYYYY(
                template[0].validUntil
              )} </p>
              ${
                template[0].recertificationDate !== 0
                  ? `<p class="claim--popup__table--content">Recertificación: ${formatDateToDDMMYYYY(
                      template[0].recertificationDate
                    )}</p>`
                  : ""
              }
            </div>
          `
                : ""
            }
            <a href="/pages/producer-landing?producer_id=1">Ver más del Productor</a>
      
            ${
              template[0] && template[0].blockchainTx.length !== 0
                ? `
                      <a href="https://mumbai.polygonscan.com/tx/${template[0].blockchainTx}" target="_blank" rel="noopener noreferrer">Ver Registro en blockchain <svg xmlns="http://www.w3.org/2000/svg" height="0.7em" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#959b03}</style><path d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"/></svg></a>
                      `
                : ""
            }
            
            </div>
      </div>`;

// Agregar evento click al marcador para mostrar información
        marker.addListener("click", function() {

// Cerrar el InfoWindow actualmente abierto, si existe
          if (currentInfoWindow) {
            currentInfoWindow.close();
          }

// Crear ventana de información
          var infoWindow = new google.maps.InfoWindow({content: contentString});

// Mostrar ventana de información
          infoWindow.open(map, marker);

// Actualizar la referencia al InfoWindow actualmente abierto
          currentInfoWindow = infoWindow;
        });
      } else {
        var circle = new google.maps.Circle({
          strokeColor: "#FF0000",
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: "#FF0000",
          fillOpacity: 0.35,
          map: map,
          center: producer.location,
          radius: 3000, // Radio del círculo en metros (puedes ajustar este valor)
        });

        // Crear el contenido personalizado con HTML
        var contentString = `<div id="content" class="content-popup-map" style="width: 200px; display:flex; flex-direction: column; gap: 10px;">
            <h2 id="firstHeading" class="firstHeading">
            ${producer.name}
            </h2>
            <img src="${
              producer.imgUrl
            }" style="height: 50px; width: 100px; object-fit: cover;" loading="lazy"/>
            <p>${producer.description}</p>
            ${
              template[0]
                ? template[0].claimFiles
                    .filter((element) => element !== "")
                    .map(
                      (element) =>
                        `<a href="${element.url}" target="_blank" rel="noopener noreferrer">Ver evidencia <svg xmlns="http://www.w3.org/2000/svg" height="0.75em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#959b03}</style><path d="M0 64C0 28.7 28.7 0 64 0H224V128c0 17.7 14.3 32 32 32H384V304H176c-35.3 0-64 28.7-64 64V512H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0L384 128zM176 352h32c30.9 0 56 25.1 56 56s-25.1 56-56 56H192v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V448 368c0-8.8 7.2-16 16-16zm32 80c13.3 0 24-10.7 24-24s-10.7-24-24-24H192v48h16zm96-80h32c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H304c-8.8 0-16-7.2-16-16V368c0-8.8 7.2-16 16-16zm32 128c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H320v96h16zm80-112c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16s-7.2 16-16 16H448v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16H448v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V432 368z"/></svg> </a>`
                    )
                    .join(" ")
                : ""
            } 
            ${
              template[0].claimFiles.length !== 0
                ? `
            <div class="claim--popup__table">
              <p class="claim--popup__table--title">Fechas</p>
              <p class="claim--popup__table--content">Emisión: ${formatDateToDDMMYYYY(
                template[0].validFrom
              )}</p>
              <p class="claim--popup__table--content">Validez: ${formatDateToDDMMYYYY(
                template[0].validUntil
              )} </p>
              ${
                template[0].recertificationDate !== 0
                  ? `<p class="claim--popup__table--content">Recertificación: ${formatDateToDDMMYYYY(
                      template[0].recertificationDate
                    )}</p>`
                  : ""
              }
            </div>
          `
                : ""
            }
            <a href="/pages/producer-landing?producer_id=1">Ver más del Productor</a>
      
            ${
              template[0] && template[0].blockchainTx.length !== 0
                ? `
                      <a href="https://mumbai.polygonscan.com/tx/${template[0].blockchainTx}" target="_blank" rel="noopener noreferrer">Ver Registro en blockchain <svg xmlns="http://www.w3.org/2000/svg" height="0.7em" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#959b03}</style><path d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"/></svg></a>
                      `
                : ""
            }
            
            </div>
      </div>`;

// Agregar evento click al círculo para mostrar información
        circle.addListener("click", function() {

// Crear ventana de información
          if (currentInfoWindow) {
            currentInfoWindow.close();
          }
          var infoWindow = new google.maps.InfoWindow({content: contentString});

// Mostrar ventana de información
          infoWindow.setPosition(producer.location);
          infoWindow.open(map);

// Actualizar la referencia al InfoWindow actualmente abierto
          currentInfoWindow = infoWindow;
        });
      }

/*
// Crear marcador
      var marker = new google.maps.Marker({position: producer.location, map: map, title: producer.name});


// // Crear el contenido personalizado con HTML
      var contentString = '<div id="content" style="width: 200px; display:flex; flex-direction: column; gap: 10px">' + '<h2 id="firstHeading" class="firstHeading">' + producer.name + '</h2>' + '<p>' + producer.description + '</p>' + '</div>' + '<a href="' + producer.producerId + '"  target="_blank" rel="noopener noreferrer">Ver Documento</p>' + '</div>';

// // Agregar evento click al marcador para mostrar información
      marker.addListener("click", function() {

//     // Crear ventana de información
        var infoWindow = new google.maps.InfoWindow({content: contentString});

//     // Mostrar ventana de información
        infoWindow.open(map, marker);
      });
*/
// });

    }

// Función para crear elementos HTML y agregarlos al contenedor
// Función para crear los elementos HTML para cada productor
    function createClaimElement(claim) {
      const div = document.createElement('a');
      div.classList.add('landing__producer--item');
      div.href = `/pages/claim-landing?claim_id=${
        claim.claimId
      }`;
      const img = document.createElement('img');
      img.src = claim.image;
      img.alt = "#";
      img.classList.add('landing__producer--item_img');
      img.style.maxWidth = "250px";
      img.style.maxHeight = "200px";
      img.style.margin = "auto";

      const h3 = document.createElement('h5');
      h3.textContent = claim.claimName;
      h3.classList.add('landing__producer--item_title');

      div.appendChild(img);
      div.appendChild(h3);

      return div;
    }
  </script>

  <div id="producerContainer" class="landing__producer">
    <div class="container prose">

      <div class="landing__producer--head">
        <img style="width: 100%;" id="landing__producer--image" src="" alt="">
        <h1 class="landing__producer--head_title text-center"></h1>
        <p class="landing__producer--head_text"></p>
        <!-- 
        <iframe
          id="youtubeIframe"
          width="560"
          height="315"
          src="https://www.youtube.com/embed/W5-RsmMzcT0"
          frameborder="0"
          allowfullscreen></iframe>
          -->
      </div>
      <h2 class="landing__claim--subtitle text-center">
        Nuestros sellos
      </h2>
      <div class="landing__producer--boxes"></div>
      <div id="map" style="height: 400px; width: 100%"></div>
    </div>
  </div>
</div>
<div id="noProducerIDcontent" class="d-none">
  <div class="landing__producer">
    <div class="container prose">
      <h1 class="landing__producer--head_title text-center">{{ section.settings.title }}</h1>
      <div class="landing__producer--head_text">{{ section.settings.text }}</div>
      <div class="landing__producer--producers"></div>
    </div>
  </div>
  <script>
    function createProducerElement(producer) {
      const div = document.createElement('a');
      div.classList.add('landing__producer--item');
      div.href = `/pages/producer-landing?producer_id=${
        producer.producerId
      }`
      const img = document.createElement('img');
      img.src = producer.imgUrl;
      img.alt = "#";
      img.classList.add('landing__producer--item_img');
      img.style.maxWidth = "250px";
      img.style.maxHeight = "200px";
      const h3 = document.createElement('h5');
      h3.textContent = producer.name;
      h3.classList.add('landing__producer--item_title');
      div.appendChild(img);
      div.appendChild(h3);

      return div;
    }
  </script>
</div>



{% schema %}
  {
    "name": "Landing Producer",
    "settings": [
      {
        "type": "text",
        "label": "Titulo",
        "id": "title",
        "default": "Nuestros Productores"
      }, {
        "type": "richtext",
        "label": "Texto principal",
        "id": "text",
        "default": "<p>Como ecoterra estamos orgullosos de trabajar juntos a nuestros productores comprometidos a cambiar el planeta. Lorem ipsum dolor sit amet consectetur adipisicing elit. Earum doloremque nihil architecto nam, libero rem dolore! Voluptates labore suscipit quas soluta neque, sint amet eius non excepturi tenetur reprehenderit ipsum.</p>"
      }
    ],
    "presets": [
      {
        "name": "Landing Producer",
        "category": "Landing",
        "settings": {}
      }
    ]
  }
{% endschema %}